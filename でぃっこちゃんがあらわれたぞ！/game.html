<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ディッコちゃんわからせゲーム</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: monospace; overflow: hidden; touch-action: none; }
        #game-container { width: 360px; height: 480px; position: relative; border: 2px solid #fff; margin: auto; display: flex; flex-direction: column; }
        
        /* ゲージとメッセージ */
        #status-area { padding: 10px; font-size: 14px; border-bottom: 1px solid #444; }
        .gauge-container { width: 100%; height: 10px; background: #222; margin: 5px 0; border: 1px solid #666; }
        .gauge-bar { height: 100%; width: 0%; transition: width 0.3s; }
        #sub-bar { background: #f0f; }
        #ctrl-bar { background: #0f0; width: 40%; }

        #character-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; }
        #character-image { max-width: 80%; animation: breathe 3s ease-in-out infinite alternate; }
        @keyframes breathe { from { transform: translateY(0); } to { transform: translateY(-10px); } }

        /* 重要：わからせ成功オーバーレイ */
        #win-overlay {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; pointer-events: auto; /* クリックを許可 */
        }
        .success-text { color: #f0f; font-size: 28px; font-weight: bold; margin-bottom: 20px; text-shadow: 0 0 10px #f0f; }
        
        .choice-buttons { display: flex; gap: 10px; z-index: 110; }
        .choice-btn {
            width: 140px; height: 80px; background: #222; border: 2px solid #fff; color: #fff;
            font-size: 14px; cursor: pointer; pointer-events: auto;
        }

        /* ボタン配置 */
        #button-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; padding: 10px; height: 100px; }
        .game-button { background: #222; color: #fff; border: 1px solid #fff; cursor: pointer; }

        /* スライドショー */
        #slideshow-container {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 1000; justify-content: center; align-items: center;
        }
        #slideshow-image { max-width: 100%; max-height: 100%; opacity: 0; transition: opacity 0.5s; }
        #slideshow-image.active { opacity: 1; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="status-area">
        屈服度: <span id="sub-val">0</span>% <div class="gauge-container"><div id="sub-bar" class="gauge-bar"></div></div>
        制御力: 21 <div class="gauge-container"><div id="ctrl-bar" class="gauge-bar"></div></div>
    </div>

    <div id="character-area">
        <img src="ball.png" id="character-image">
        
        <div id="win-overlay">
            <div class="success-text">わからせ成功！</div>
            <div style="margin-bottom:20px;">どうしてあげる？</div>
            <div class="choice-buttons">
                <button class="choice-btn" onclick="startEnding('prison')">触手牢屋へ<br>放り込む</button>
                <button class="choice-btn" onclick="startEnding('love')">いっぱい<br>愛してあげる</button>
            </div>
        </div>
    </div>

    <div id="button-grid">
        <button class="game-button" onclick="handleAction('戦う')">戦う</button>
        <button class="game-button" onclick="handleAction('犯す')">犯す</button>
        <button class="game-button" onclick="handleAction('デート')">デート</button>
        <button class="game-button" onclick="handleAction('逃げる')">逃げる</button>
    </div>
</div>

<div id="slideshow-container" onclick="showNextSlide()">
    <img id="slideshow-image" src="">
</div>

<script>
    let slideImages = [];
    let slideIndex = 0;
    let isEndingStarted = false;

    function handleAction(action) {
        if (action === '犯す') {
            document.getElementById('sub-bar').style.width = "100%";
            document.getElementById('sub-val').innerText = "100";
            setTimeout(() => {
                document.getElementById('win-overlay').style.display = 'flex';
            }, 500);
        }
    }

    // エンド開始処理（提供いただいたロジックを統合）
    function startEnding(type) {
        if (isEndingStarted) return;
        isEndingStarted = true;

        document.getElementById('win-overlay').style.display = 'none';
        document.getElementById('game-container').style.display = 'none';
        document.getElementById('slideshow-container').style.display = 'flex';

        slideImages = [];
        const maxImages = 20;
        for (let i = 1; i <= maxImages; i++) {
            const num = i.toString().padStart(3, '0');
            let path = "";
            if (type === 'love') {
                path = `date/dikkochan202507_${num}.jpg`;
            } else {
                // スクリーンショットのパスを再現（日本語/スペース対応）
                path = `tentacles/DIKKOCHAN4_${num}（カスタム）.jpg`;
            }
            slideImages.push(path);
        }
        slideIndex = 0;
        showNextSlide();
    }

    function showNextSlide() {
        const slideImg = document.getElementById('slideshow-image');
        if (slideIndex >= slideImages.length) {
            alert("わからせ完了！");
            location.reload();
            return;
        }

        const targetSrc = slideImages[slideIndex];
        slideImg.classList.remove('active');

        // 画像のプリロードとエラーハンドリング
        const tempImg = new Image();
        tempImg.src = encodeURI(targetSrc); 
        
        tempImg.onload = () => {
            slideImg.src = tempImg.src;
            slideImg.classList.add('active');
            slideIndex++;
        };

        tempImg.onerror = () => {
            console.error("画像が見つかりません:", targetSrc);
            slideIndex++;
            if (slideIndex < slideImages.length) {
                showNextSlide();
            } else {
                alert("画像がGitHubに正しく上がっていないようです。");
                location.reload();
            }
        };
    }
</script>
</body>
</html>