// エンド開始処理
function startEnding(type) {
    if (isEndingStarted) return;
    isEndingStarted = true;

    document.getElementById('win-overlay').style.display = 'none';
    document.getElementById('game-container').style.display = 'none';
    document.getElementById('slideshow-container').style.display = 'flex';

    slideImages = [];
    const maxImages = 20; 

    for (let i = 1; i <= maxImages; i++) {
        const num = i.toString().padStart(3, '0');
        let path = "";
        if (type === 'love') {
            path = `date/dikkochan202507_${num}.jpg`;
        } else {
            // スペースやカッコをURL形式に安全に変換
            path = `tentacles/DIKKOCHAN4_${num} (カスタム).jpg`;
        }
        slideImages.push(path);
    }
    
    slideIndex = 0;
    showNextSlide();
}

// 次のスライドを表示（エラーハンドリング強化）
function showNextSlide() {
    const slideImg = document.getElementById('slideshow-image');
    if (slideIndex >= slideImages.length) {
        alert("わからせ完了！");
        location.reload();
        return;
    }

    const targetSrc = slideImages[slideIndex];
    slideImg.classList.remove('active');

    const tempImg = new Image();
    tempImg.src = encodeURI(targetSrc); // 日本語やスペースを安全に変換

    tempImg.onload = () => {
        slideImg.src = tempImg.src;
        slideImg.classList.add('active');
        slideIndex++;
    };

    tempImg.onerror = () => {
        console.error("画像が見つかりません:", targetSrc);
        // 画像が1枚なくても、次の番号を試す（進行不能を防止）
        slideIndex++;
        if (slideIndex < slideImages.length) {
            showNextSlide();
        } else {
            alert("画像がGitHubに正しく上がっていないようです。");
            location.reload();
        }
    };
}